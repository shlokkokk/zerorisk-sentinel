<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Analysis Results - ZeroRisk Spyware Intelligence</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/echarts/5.4.3/echarts.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pixi.js/7.2.4/pixi.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;500;700&family=Inter:wght@300;400;500;600;700&family=Orbitron:wght@400;700;900&display=swap"
      rel="stylesheet"
    />
    <link rel="icon" type="image/png" href="logofav.png" />

    <style>
      :root {
        --bg-primary: #0a0a0a;
        --bg-secondary: #1a1a1a;
        --terminal-green: #00ff41;
        --warning-amber: #ff6b35;
        --critical-red: #dc143c;
        --accent-blue: #00d4ff;
        --text-primary: #ffffff;
        --text-secondary: #e0e0e0;
      }

      body {
        font-family: "Inter", sans-serif;
        background: var(--bg-primary);
        color: var(--text-primary);
        line-height: 1.6;
      }

      .font-mono {
        font-family: "JetBrains Mono", monospace;
      }
      .font-orbitron {
        font-family: "Orbitron", sans-serif;
      }

      .matrix-bg {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        z-index: -1;
        opacity: 0.18;
      }
      /*scrollbar */
      .analysis-card::-webkit-scrollbar {
        width: 6px;
      }

      .analysis-card::-webkit-scrollbar-track {
        background: transparent;
      }

      .analysis-card::-webkit-scrollbar-thumb {
        background: linear-gradient(180deg, #00d4ff, #00ff41);
        border-radius: 10px;
        box-shadow: 0 0 6px rgba(0, 212, 255, 0.6);
      }

      .analysis-card {
        scrollbar-width: thin;
        scrollbar-color: #00d4ff transparent;
      }

      .analysis-card {
        background: rgba(18, 18, 18, 0.98);
        border: 1px solid rgba(0, 212, 255, 0.35);
        position: relative;
        z-index: 10;
        isolation: isolate;

        overflow: auto; /* scroll instead of cut */
        max-height: none; /* IMPORTANT */
      }

      .analysis-card:hover {
        border-color: var(--accent-blue);
        box-shadow: 0 0 30px rgba(0, 212, 255, 0.2);
      }

      .threat-badge {
        padding: 4px 12px;
        border-radius: 20px;
        font-size: 12px;
        font-weight: 600;
        text-transform: uppercase;
      }

      .threat-safe {
        background: rgba(0, 255, 65, 0.2);
        color: var(--terminal-green);
      }
      .threat-low {
        background: rgba(0, 212, 255, 0.2);
        color: var(--accent-blue);
      }
      .threat-medium {
        background: rgba(255, 107, 53, 0.2);
        color: var(--warning-amber);
      }
      .threat-high {
        background: rgba(220, 20, 60, 0.2);
        color: var(--critical-red);
      }
      .threat-critical {
        background: rgba(220, 20, 60, 0.3);
        color: var(--critical-red);
      }

      .hex-viewer {
        background: #000;
        color: var(--terminal-green);
        font-family: "JetBrains Mono", monospace;
        font-size: 12px;
        line-height: 1.4;
        padding: 16px;
        border-radius: 8px;
        border: 1px solid var(--terminal-green);
        max-height: 200px;
        overflow-y: auto;
      }

      .finding-card {
        border-left: 4px solid;
        padding: 16px;
        margin-bottom: 12px;
        border-radius: 0 8px 8px 0;
      }

      .finding-critical {
        border-color: var(--critical-red);
        background: rgba(220, 20, 60, 0.1);
      }
      .finding-high {
        border-color: var(--critical-red);
        background: rgba(220, 20, 60, 0.1);
      }
      .finding-medium {
        border-color: var(--warning-amber);
        background: rgba(255, 107, 53, 0.1);
      }
      .finding-low {
        border-color: var(--accent-blue);
        background: rgba(0, 212, 255, 0.1);
      }

      .expandable-section {
        cursor: pointer;
        transition: all 0.3s ease;
      }

      .expandable-section:hover {
        background: rgba(0, 212, 255, 0.05);
      }

      .expand-icon {
        transition: transform 0.3s ease;
      }

      .expanded .expand-icon {
        transform: rotate(180deg);
      }

      .nav-glow {
        transition: all 0.3s ease;
      }

      .nav-glow:hover {
        text-shadow: 0 0 10px var(--accent-blue);
        color: var(--accent-blue);
      }

      .status-indicator {
        width: 8px;
        height: 8px;
        border-radius: 50%;
        background: var(--terminal-green);
        animation: pulse 2s infinite;
      }

      @keyframes pulse {
        0%,
        100% {
          opacity: 1;
        }
        50% {
          opacity: 0.3;
        }
      }

      .chart-container {
        height: 300px;
        width: 100%;
      }

      .recommendation-card {
        background: rgba(0, 212, 255, 0.1);
        border: 1px solid rgba(0, 212, 255, 0.3);
        border-radius: 8px;
        padding: 16px;
        margin-bottom: 12px;
      }

      .action-button {
        background: var(--accent-blue);
        color: white;
        border: none;
        padding: 8px 16px;
        border-radius: 6px;
        font-size: 14px;
        cursor: pointer;
        transition: all 0.3s ease;
      }

      .action-button:hover {
        background: #0099cc;
        box-shadow: 0 0 15px rgba(0, 212, 255, 0.5);
      }

      @media (max-width: 768px) {
        .hex-viewer {
          font-size: 10px;
          padding: 12px;
        }
        .chart-container {
          height: 250px;
        }
      }
      body {
        transition: opacity 0.25s ease, transform 0.25s ease;
      }

      body.page-exit-left {
        opacity: 0;
        transform: translateX(-20px);
      }

      body.page-exit-right {
        opacity: 0;
        transform: translateX(20px);
      }

      ::-webkit-scrollbar {
        width: 10px;
      }

      ::-webkit-scrollbar-track {
        background: rgba(10, 10, 10, 0.8);
      }

      ::-webkit-scrollbar-thumb {
        background: linear-gradient(180deg, #00d4ff, #00ff88);
        border-radius: 999px;
        border: 2px solid rgba(10, 10, 10, 0.9);
      }

      ::-webkit-scrollbar-thumb:hover {
        background: linear-gradient(180deg, #00ff88, #00d4ff);
      }

      * {
        scrollbar-width: thin;
        scrollbar-color: #00d4ff rgba(10, 10, 10, 0.8);
      }
      /* ntg */
      .apk-card .spyware-section,
      .apk-card .risk-context,
      .apk-card .keylogger-section {
        display: none;
      }
  .report-btn-container:hover .coming-soon-tooltip {
    opacity: 1;
    visibility: visible;
    transform: translateX(-50%) scale(1);
  }
  .report-btn-container:hover .report-btn-glow {
    opacity: 0.6;
  }
    </style>
</head>
  <body>
    <!-- Matrix Background Canvas -->
    <canvas id="matrixCanvas" class="matrix-bg"></canvas>

    <!-- Navigation -->
    <nav
      class="fixed top-0 w-full z-50 bg-black bg-opacity-80 backdrop-blur-md border-b border-gray-800"
    >
      <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
        <div class="flex items-center justify-between h-16">
          <div class="flex items-center space-x-3">
            <img
              src="logofav.png"
              alt="ZeroRisk Sentinel"
              class="w-8 h-8 rounded-lg object-cover"
            />
            <h1 class="font-orbitron text-xl font-bold text-white">
              ZeroRisk Sentinel
            </h1>
          </div>

          <div class="hidden md:flex items-center space-x-8">
            <a
              href="index.html"
              class="nav-glow text-gray-300 hover:text-blue-400 px-3 py-2 text-sm font-medium"
              >Scanner</a
            >
            <a
              href="#"
              class="nav-glow text-white hover:text-blue-400 px-3 py-2 text-sm font-medium"
              >Results</a
            >
            <a
              href="about.html"
              class="nav-glow text-gray-300 hover:text-blue-400 px-3 py-2 text-sm font-medium"
              >About</a
            >
          </div>

          <div class="flex items-center space-x-3">
            <div class="status-indicator"></div>
            <span class="text-sm text-gray-300">Analysis Complete</span>
          </div>
        </div>
      </div>
    </nav>

    <!-- Main Content -->
    <main class="pt-20 pb-12">
      <!-- Header Section -->
      <section class="py-12 px-4">
        <div class="max-w-6xl mx-auto text-center">
          <h1
            class="font-orbitron text-4xl md:text-5xl font-bold mb-4 text-white"
          >
            Security Analysis <span class="text-blue-400">Results</span>
          </h1>
          <p class="text-xl text-gray-300 mb-8">
            Comprehensive file security assessment and threat analysis
          </p>

          <!-- Summary Cards -->
          <div class="grid grid-cols-1 md:grid-cols-4 gap-6 mb-12">
            <div class="analysis-card rounded-xl p-6">
              <div
                id="filesAnalyzed"
                class="text-3xl font-bold text-green-400 mb-2"
              >
                0
              </div>
              <div class="text-gray-400">Files Analyzed</div>
            </div>
            <div class="analysis-card rounded-xl p-6">
              <div id="safeFiles" class="text-3xl font-bold text-blue-400 mb-2">
                0
              </div>
              <div class="text-gray-400">Safe Files</div>
            </div>
            <div class="analysis-card rounded-xl p-6">
              <div
                id="warningFiles"
                class="text-3xl font-bold text-yellow-400 mb-2"
              >
                0
              </div>
              <div class="text-gray-400">Warnings</div>
            </div>
            <div class="analysis-card rounded-xl p-6">
              <div
                id="criticalFiles"
                class="text-3xl font-bold text-red-400 mb-2"
              >
                0
              </div>
              <div class="text-gray-400">Critical Threats</div>
            </div>
          </div>
        </div>
      </section>

      <!-- Detailed Analysis -->
      <section class="py-12 px-4">
        <div class="max-w-6xl mx-auto">
          <div
            id="fileOverview"
            class="grid grid-cols-1 lg:grid-cols-2 gap-8 mb-12"
          >
            <!-- Threat Distribution Chart -->
            <div class="analysis-card rounded-xl p-6">
              <h3 class="text-xl font-semibold mb-6 text-white">
                Threat Proximity Map
              </h3>
              <div id="threatChart" class="chart-container"></div>
            </div>

            <!-- Security Score Meter -->
            <div class="analysis-card rounded-xl p-6">
              <h3 class="text-xl font-semibold mb-6 text-white">
                Overall Security Score
              </h3>
              <div class="flex items-center justify-center mb-6">
                <div class="relative w-48 h-48">
                  <div id="securityScoreChart" class="chart-container"></div>
                </div>
              </div>
              <div class="text-center">
                <div class="text-2xl font-bold text-white mb-2">
                  Security Score: 67/100
                </div>
                <div class="text-gray-400">Moderate Risk Level</div>
              </div>
            </div>
          </div>

          <!-- File Analysis Details -->
          <div id="fileSection" class="space-y-6">
            <h2
              class="font-orbitron text-3xl font-bold text-center mb-8 text-white"
            >
              Detailed File Analysis
            </h2>

            <!-- REAL RESULTS WILL BE INJECTED HERE -->
            <div id="dynamicFileResults" class="space-y-6"></div>
          </div>
          <!-- URL Security Analysis -->
          <div id="urlSection" class="space-y-6 mt-16">
            <h2
              class="font-orbitron text-3xl font-bold text-center mb-8 text-white"
            >
              URL Security Analysis
            </h2>

            <!-- URL RESULTS WILL BE INJECTED HERE -->
            <p class="text-center text-gray-400 text-sm mb-4">
              Heuristic-based URL risk analysis (no live browsing or execution)
            </p>

            <div id="urlResults" class="space-y-6"></div>
          </div>

          <!-- Batch Actions -->
<div class="mt-16 text-center">
  <div class="report-btn-container" style="position: relative; display: inline-block;">
    
    <!-- Glow effect -->
    <div class="report-btn-glow" style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); width: 120%; height: 140%; background: radial-gradient(ellipse, rgba(0, 212, 255, 0.4) 0%, transparent 70%); filter: blur(20px); opacity: 0; transition: opacity 0.4s ease; pointer-events: none; z-index: -1;"></div>
    
    <!-- Enabled Button -->
    <button class="report-btn-premium" onclick="openReportModal()" style="
      position: relative;
      background: linear-gradient(135deg, #00d4ff 0%, #0099cc 50%, #0077aa 100%);
      color: #fff;
      border: none;
      padding: 16px 48px;
      border-radius: 12px;
      font-size: 16px;
      font-weight: 600;
      font-family: 'Orbitron', sans-serif;
      letter-spacing: 1px;
      cursor: pointer;
      overflow: hidden;
      transition: all 0.4s ease;
      box-shadow: 0 4px 20px rgba(0, 212, 255, 0.3), inset 0 1px 0 rgba(255, 255, 255, 0.2);
    ">
      <span style="display: inline-block; margin-right: 12px; opacity: 1;">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="vertical-align: middle;">
          <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
          <polyline points="14 2 14 8 20 8"></polyline>
          <line x1="16" y1="13" x2="8" y2="13"></line>
          <line x1="16" y1="17" x2="8" y2="17"></line>
          <polyline points="10 9 9 9 8 9"></polyline>
        </svg>
      </span>
      Generate Summary Report
    </button>

  </div>
</div>

          <!-- Report Format Modal -->
          <div id="reportModal" style="position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.85); backdrop-filter: blur(8px); display: flex; align-items: center; justify-content: center; z-index: 1000; opacity: 0; visibility: hidden; transition: all 0.4s ease;">
            <div style="background: linear-gradient(145deg, #0f0f0f, #1a1a1a); border: 1px solid rgba(0,212,255,0.4); border-radius: 20px; padding: 48px; max-width: 520px; width: 90%; position: relative; transform: scale(0.9); opacity: 0; transition: all 0.5s ease;">
              <button onclick="closeReportModal()" style="position: absolute; top: 20px; right: 20px; width: 36px; height: 36px; border-radius: 50%; background: rgba(255,255,255,0.05); border: 1px solid rgba(255,255,255,0.1); color: #888; cursor: pointer; font-size: 18px;">&times;</button>
              <div style="text-align: center; margin-bottom: 36px;">
                <h2 style="font-family: 'Orbitron', sans-serif; font-size: 24px; font-weight: 700; color: #fff; margin-bottom: 8px;">Generate Summary Report</h2>
                <p style="color: #888; font-size: 14px;">Select your preferred export format</p>
              </div>
              <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 32px;">
                <div class="format-opt" onclick="selectFormat('json')" id="fmt-json" style="background: rgba(255,255,255,0.03); border: 2px solid rgba(0,212,255,0.2); border-radius: 16px; padding: 28px 20px; cursor: pointer; text-align: center; transition: all 0.35s ease;">
                  <div style="width: 56px; height: 56px; margin: 0 auto 16px; border-radius: 14px; display: flex; align-items: center; justify-content: center; font-family: 'JetBrains Mono', monospace; font-size: 14px; font-weight: 700; background: linear-gradient(135deg, #00ff88, #00cc6a); color: #000;">JSON</div>
                  <div style="font-size: 16px; font-weight: 600; color: #fff; margin-bottom: 6px;">JSON Format</div>
                  <div style="font-size: 12px; color: #888;">Machine-readable data</div>
                </div>
                <div class="format-opt" onclick="selectFormat('pdf')" id="fmt-pdf" style="background: rgba(255,255,255,0.03); border: 2px solid rgba(0,212,255,0.2); border-radius: 16px; padding: 28px 20px; cursor: pointer; text-align: center; transition: all 0.35s ease;">
                  <div style="width: 56px; height: 56px; margin: 0 auto 16px; border-radius: 14px; display: flex; align-items: center; justify-content: center; font-family: 'JetBrains Mono', monospace; font-size: 14px; font-weight: 700; background: linear-gradient(135deg, #ff6b35, #cc5529); color: #fff;">PDF</div>
                  <div style="font-size: 16px; font-weight: 600; color: #fff; margin-bottom: 6px;">PDF Document</div>
                  <div style="font-size: 12px; color: #888;">Professional report</div>
                </div>
              </div>
              <div style="display: flex; gap: 16px;">
                <button onclick="closeReportModal()" style="flex: 1; padding: 14px 24px; border-radius: 10px; font-size: 14px; font-weight: 600; cursor: pointer; background: rgba(255,255,255,0.05); color: #888; border: 1px solid rgba(255,255,255,0.1);">Cancel</button>
                <button id="genReportBtn" onclick="generateSelectedReport()" disabled style="flex: 1; padding: 14px 24px; border-radius: 10px; font-size: 14px; font-weight: 600; cursor: pointer; background: linear-gradient(135deg, #00d4ff, #0099cc); color: #fff; border: none; opacity: 0.5;">Generate Report</button>
              </div>
            </div>
          </div>
        </div>
      </section>
    </main>

    <!-- Footer -->
    <footer class="bg-gray-900 border-t border-gray-800 py-8">
      <div class="max-w-6xl mx-auto px-4 text-center">
        <p class="text-gray-400">
          &copy; 2025 ZeroRisk Sentinel. Advanced cybersecurity for the digital
          age.
        </p>
      </div>
    </footer>

    <script>
      let securityGaugeChart = null;
      let lastSecurityScore = 0;

      function startMatrixBackground() {
        const canvas = document.getElementById("matrixCanvas");
        const ctx = canvas.getContext("2d");

        canvas.width = window.innerWidth;
        canvas.height = window.innerHeight;

        const chars =
          "01„Ç¢„Ç§„Ç¶„Ç®„Ç™„Ç´„Ç≠„ÇØ„Ç±„Ç≥„Çµ„Ç∑„Çπ„Çª„ÇΩ„Çø„ÉÅ„ÉÑ„ÉÜ„Éà„Éä„Éã„Éå„Éç„Éé„Éè„Éí„Éï„Éò„Éõ„Éû„Éü„É†„É°„É¢„É§„É¶„É®„É©„É™„É´„É¨„É≠„ÉØ„É≤„É≥";
        const charArray = chars.split("");

        const fontSize = 14;
        const columns = canvas.width / fontSize;
        const drops = Array(Math.floor(columns)).fill(1);

        function drawMatrix() {
          ctx.fillStyle = "rgba(10, 10, 10, 0.04)";
          ctx.fillRect(0, 0, canvas.width, canvas.height);

          ctx.fillStyle = "#00ff41";
          ctx.font = `${fontSize}px JetBrains Mono`;

          for (let i = 0; i < drops.length; i++) {
            const text =
              charArray[Math.floor(Math.random() * charArray.length)];
            ctx.fillText(text, i * fontSize, drops[i] * fontSize);

            if (drops[i] * fontSize > canvas.height && Math.random() > 0.975) {
              drops[i] = 0;
            }
            drops[i]++;
          }
        }

        setInterval(drawMatrix, 35);

        window.addEventListener("resize", () => {
          canvas.width = window.innerWidth;
          canvas.height = window.innerHeight;
        });
      }

      // Toggle expandable sections
      function toggleSection(sectionId) {
        const section = document.getElementById(sectionId);
        const button = section.previousElementSibling;
        const icon = button.querySelector(".expand-icon");

        if (section.classList.contains("hidden")) {
          section.classList.remove("hidden");
          button.classList.add("expanded");

          anime({
            targets: section,
            opacity: [0, 1],
            maxHeight: [0, "1000px"],
            duration: 500,
            easing: "easeOutQuart",
          });
        } else {
          anime({
            targets: section,
            opacity: [1, 0],
            maxHeight: ["1000px", 0],
            duration: 300,
            easing: "easeInQuart",
            complete: () => {
              section.classList.add("hidden");
              button.classList.remove("expanded");
            },
          });
        }
      }
      function calculateChartData() {
        const storedResults = sessionStorage.getItem("analysisResults");
        if (!storedResults) {
          return { safe: 0, warning: 0, critical: 0, avgScore: 0 };
        }

        const results = JSON.parse(storedResults);

        let safe = 0,
          warning = 0,
          critical = 0;
        let totalScore = 0;

        results.forEach((file) => {
          if (file.threatLevel === "safe") safe++;
          else if (file.threatLevel === "low" || file.threatLevel === "medium")
            warning++;
          else if (
            file.threatLevel === "high" ||
            file.threatLevel === "critical"
          )
            critical++;

          totalScore += file.threatScore;
        });

        const avgThreat = results.length
          ? Math.round(totalScore / results.length)
          : 0;

        const avgScore = Math.max(0, 100 - avgThreat);

        return { safe, warning, critical, avgScore };
      }

      function initializeCharts() {
        console.log("CHART DATA ‚Üí", calculateChartData());
        const { safe, warning, critical, avgScore } = calculateChartData();
        const threatChart = echarts.init(
          document.getElementById("threatChart")
        );
        // Security Score Chart
        const scoreChart = echarts.init(
          document.getElementById("securityScoreChart")
        );
        securityGaugeChart = scoreChart;
        lastSecurityScore = avgScore;

        const RAD = Math.PI / 180;
        let orbitAnimationId = null;

        const orbitConfig = {
          critical: { radius: 22, speed: 0.6, color: "#ff0033", size: 9 },
          warning: { radius: 40, speed: 0.4, color: "#ff9900", size: 8 },
          safe: { radius: 60, speed: 0.25, color: "#00ff66", size: 8 },
        };

        const messages = {
          critical: "High-risk activity detected near system core",
          warning: "Unusual behavior flagged for review",
          safe: "No security concerns detected",
        };

        const emptyMessages = {
          critical: "No critical threats detected",
          warning: "No warnings found",
          safe: "No safe files recorded",
        };

        let angles = {
          critical: 0,
          warning: 120,
          safe: 240,
        };

        function buildOrbitPoints(level, count) {
          const cfg = orbitConfig[level];
          const total = count > 0 ? count : 6;
          const real = count > 0;

          return Array.from({ length: total }, (_, i) => {
            const a = ((i * 360) / total + angles[level]) * RAD;
            return {
              value: [cfg.radius * Math.cos(a), cfg.radius * Math.sin(a)],
              level,
              real,
              symbolSize: real ? cfg.size : cfg.size - 2,
              itemStyle: {
                color: cfg.color,
                opacity: real ? 1 : 0.18,
                shadowBlur: real ? 14 : 0,
                shadowColor: cfg.color,
              },
            };
          });
        }

        // Initial static layout
        threatChart.setOption({
          backgroundColor: "transparent",
          grid: { left: 0, right: 0, top: 0, bottom: 0 },

          xAxis: { show: false, min: -70, max: 70, scale: false },
          yAxis: { show: false, min: -70, max: 70, scale: false },

          tooltip: {
            trigger: "item",
            confine: true,
            backgroundColor: "#0a0a0a",
            borderColor: "#222",
            textStyle: { color: "#eee", fontFamily: "JetBrains Mono" },
            formatter: (p) => {
              const lvl = p.data.level;
              return `
        <div style="font-weight:600;margin-bottom:4px">
          ${lvl.toUpperCase()}
        </div>
        <div style="font-size:12px;opacity:.85">
          ${p.data.real ? messages[lvl] : emptyMessages[lvl]}
        </div>`;
            },
          },
          series: [
            // Orbit rings
            ...["critical", "warning", "safe"].map((k) => ({
              type: "line",
              silent: true,
              symbol: "none",
              lineStyle: { opacity: 0.18 },
              data: Array.from({ length: 360 }, (_, i) => [
                orbitConfig[k].radius * Math.cos(i * RAD),
                orbitConfig[k].radius * Math.sin(i * RAD),
              ]),
            })),

            // dots animation
            { type: "scatter", data: [] },
            { type: "scatter", data: [] },
            { type: "scatter", data: [] },
          ],
        });

        function animateOrbits() {
          angles.critical += orbitConfig.critical.speed;
          angles.warning += orbitConfig.warning.speed;
          angles.safe += orbitConfig.safe.speed;

          threatChart.setOption(
            {
              series: [
                {},
                {},
                {},
                { data: buildOrbitPoints("critical", critical) },
                { data: buildOrbitPoints("warning", warning) },
                { data: buildOrbitPoints("safe", safe) },
              ],
            },
            false
          );

          orbitAnimationId = requestAnimationFrame(animateOrbits);
        }

        animateOrbits();

        window.addEventListener("resize", () => {
          if (orbitAnimationId) {
            cancelAnimationFrame(orbitAnimationId);
            orbitAnimationId = null;
          }

          threatChart.resize();

          angles = { critical: 0, warning: 120, safe: 240 };
          animateOrbits();
        });

        const scoreOption = {
          backgroundColor: "transparent",
          series: [
            {
              type: "gauge",
              radius: "100%",
              center: ["50%", "50%"],
              startAngle: 225,
              endAngle: -45,
              min: 0,
              max: 100,
              splitNumber: 10,
              axisLine: {
                lineStyle: {
                  width: 15,
                  color: [
                    [0.3, "#dc143c"],
                    [0.7, "#ff6b35"],
                    [1, "#00ff41"],
                  ],
                },
              },
              pointer: {
                icon: "path://M12.8,0.7l12,40.1H0.7L12.8,0.7z",
                length: "12%",
                width: 20,
                offsetCenter: [0, "-60%"],
                itemStyle: { color: "#00d4ff" },
              },
              axisTick: {
                length: 12,
                lineStyle: { color: "auto", width: 2 },
              },
              splitLine: {
                length: 20,
                lineStyle: { color: "auto", width: 5 },
              },
              axisLabel: {
                color: "#ffffff",
                fontSize: 12,
                distance: 25,
                formatter: function (value) {
                  if (value === 0) return "0";
                  if (value === 50) return "50";
                  if (value === 100) return "100";
                  return "";
                },
              },
              detail: {
                show: false,
              },
              data: [{ value: 0, name: "Security Score" }],
            },
          ],
        };
        scoreChart.setOption(scoreOption);
        document.querySelector(
          ".text-2xl"
        ).textContent = `Security Score: ${avgScore}/100`;

        document.querySelector(".text-gray-400").textContent =
          avgScore < 40
            ? "High Risk Level"
            : avgScore < 70
            ? "Moderate Risk Level"
            : "Low Risk Level";

        // Make charts responsive
        window.addEventListener("resize", () => {
          threatChart.resize();
          scoreChart.resize();
        });
        setTimeout(() => {
          threatChart.resize();
        }, 4500);
      }

      // Action functions
      function quarantineFile(filename) {
        showNotification(`File "${filename}" has been quarantined`, "success");
      }

      function exportDetailedReport(filename) {
        showNotification(
          `Detailed report for "${filename}" exported successfully`,
          "success"
        );
      }

      function shareAnalysis(filename) {
        showNotification(
          `Analysis for "${filename}" shared successfully`,
          "success"
        );
      }

      function exportAllReports() {
        showNotification("All reports exported successfully", "success");
      }

      function quarantineAllThreats() {
        showNotification(
          "All detected threats have been quarantined",
          "success"
        );
      }

      function generateSummaryReport() {
        showNotification("Summary report generated successfully", "success");
      }

      // Notification system
      function showNotification(message, type = "info") {
        const notification = document.createElement("div");
        notification.className = `fixed top-20 right-4 z-50 p-4 rounded-lg shadow-lg max-w-sm ${
          type === "success"
            ? "bg-green-600"
            : type === "warning"
            ? "bg-yellow-600"
            : type === "error"
            ? "bg-red-600"
            : "bg-blue-600"
        } text-white`;

        notification.innerHTML = `
                <div class="flex items-center space-x-3">
                    <div class="flex-shrink-0">
                        <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"></path>
                        </svg>
                    </div>
                    <div class="flex-1">
                        <p class="text-sm font-medium">${message}</p>
                    </div>
                    <div class="flex-shrink-0">
                        <button onclick="this.parentElement.parentElement.parentElement.remove()" class="text-white hover:text-gray-200">
                            <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"></path>
                            </svg>
                        </button>
                    </div>
                </div>
            `;

        document.body.appendChild(notification);

        anime({
          targets: notification,
          translateX: [300, 0],
          opacity: [0, 1],
          duration: 300,
          easing: "easeOutQuart",
        });

        setTimeout(() => {
          anime({
            targets: notification,
            translateX: [0, 300],
            opacity: [1, 0],
            duration: 300,
            easing: "easeInQuart",
            complete: () => notification.remove(),
          });
        }, 5000);
      }
function renderURLResults(urlData) {
    const container = document.getElementById("urlResults");
    if (!container) return;
    container.innerHTML = "";

    const findingExplanations = {
        "ip_url": "IP-based URLs bypass domain reputation checks and hide ownership information, making them common in malicious infrastructure.",
        "phishing_words": "Words like 'login', 'verify', 'secure', and 'bank' are commonly used in phishing to create urgency and trick users.",
        "shortener": "URL shorteners hide the final destination, making it easy for attackers to direct users to malicious sites without detection.",
        "risky_tld": "Domains using .xyz, .tk, .ml and similar TLDs are cheap and often abused for malicious purposes.",
        "long_path": "Unusually long URL paths can indicate obfuscation or attempts to hide malicious parameters.",
        "no_https": "Without HTTPS, data transmitted to this site can be intercepted by attackers on the network.",
        "brand_impersonation": "The URL appears to impersonate a well-known brand to trick users into trusting it.",
        "malicious_verdict": "ZeroRisk Sentinel's sandbox detected malicious behavior during actual browser execution.",
        "suspicious_verdict": "Suspicious patterns were observed when the page was loaded in a sandboxed browser.",
        "phishing_detected": "The page structure and content match known phishing patterns.",
        "suspicious_resources": "The page loaded content from domains with poor reputation."
    };
    
    const serviceExplanations = {
        google_safe_browsing: "Google's database of known malicious URLs",
        urlhaus: "Community-driven malware URL database",
        virustotal_url: "Aggregated scan results from 70+ security vendors",
        ssl: "Certificate validity and security configuration",
        domain_age: "How long the domain has been registered",
        redirects: "Chain of redirects to final destination",
        dns: "Domain name system records and configuration",
        urlscan_io: "Live sandbox browser analysis via ZeroRisk Sentinel Deep Scan"
    };
    
    urlData.forEach((r, i) => {
        const card = document.createElement("div");
        card.className = "analysis-card rounded-xl p-6 mb-4";
        card.style.opacity = "0";
    
        const colors = {safe: "green", low: "blue", medium: "yellow", high: "red", critical: "red"};
        const color = colors[r.threat_level] || "gray";
    
        // Analysis type badge
        let analysisBadge = '';
        if (r.deep_scan) {
            analysisBadge = `<span class="px-2 py-1 bg-purple-500 bg-opacity-20 text-purple-400 text-xs rounded ml-2">üî¨ Deep Scan</span>`;
        } else if (r.backend_based) {
            analysisBadge = `<span class="px-2 py-1 bg-blue-500 bg-opacity-20 text-blue-400 text-xs rounded ml-2">Backend Analysis</span>`;
        } else {
            analysisBadge = `<span class="px-2 py-1 bg-gray-600 bg-opacity-20 text-gray-400 text-xs rounded ml-2">Local Analysis</span>`;
        }
    
        //  THREAT INTELLIGENCE SECTION (Shows for BOTH normal AND deep scan) 
        let threatIntelHtml = "";
        
        // Google Safe Browsing
        if (r.services?.google_safe_browsing?.available) {
            const gsb = r.services.google_safe_browsing;
            const statusClass = gsb.threat_found ? "bg-red-500 bg-opacity-20 border-red-500" : "bg-green-500 bg-opacity-10 border-green-500";
            const icon = gsb.threat_found ? "üö®" : "‚úÖ";
            const text = gsb.threat_found ? `<span class="text-red-400 font-bold">THREAT: ${gsb.threat_type}</span>` : '<span class="text-green-400">Safe</span>';
            
            threatIntelHtml += `
                <div class="p-3 rounded-lg ${statusClass} border bg-opacity-20 mb-2">
                    <div class="flex items-center justify-between">
                        <span class="text-gray-300 text-sm font-semibold">üîí Google Safe Browsing</span>
                        ${icon}
                    </div>
                    <div class="mt-1">${text}</div>
                    <div class="text-xs text-gray-500 mt-1">${serviceExplanations.google_safe_browsing}</div>
                </div>
            `;
        }
        
        // URLHaus
        if (r.services?.urlhaus?.available) {
            const uh = r.services.urlhaus;
            const statusClass = uh.listed ? "bg-red-500 bg-opacity-20 border-red-500" : "bg-green-500 bg-opacity-10 border-green-500";
            const icon = uh.listed ? "üö®" : "‚úÖ";
            const text = uh.listed ? `<span class="text-red-400 font-bold">LISTED: ${uh.threat || 'Malware'}</span>` : '<span class="text-green-400">Not Listed</span>';
            
            threatIntelHtml += `
                <div class="p-3 rounded-lg ${statusClass} border bg-opacity-20 mb-2">
                    <div class="flex items-center justify-between">
                        <span class="text-gray-300 text-sm font-semibold">üõ°Ô∏è URLHaus Database</span>
                        ${icon}
                    </div>
                    <div class="mt-1">${text}</div>
                    <div class="text-xs text-gray-500 mt-1">${serviceExplanations.urlhaus}</div>
                </div>
            `;
        }
        
        // VirusTotal
        if (r.services?.virustotal_url?.available) {
            const vt = r.services.virustotal_url;
            let statusClass, icon, text;
            
            if (vt.malicious >= 5) {
                statusClass = "bg-red-500 bg-opacity-20 border-red-500";
                icon = "üö®";
                text = `<span class="text-red-500 font-bold">${vt.malicious}/${vt.total || 70} vendors flagged this URL!</span>`;
            } else if (vt.malicious > 0) {
                statusClass = "bg-yellow-500 bg-opacity-20 border-yellow-500";
                icon = "‚ö†Ô∏è";
                text = `<span class="text-yellow-400 font-semibold">${vt.malicious}/${vt.total || 70} vendors flagged this URL</span>`;
            } else {
                statusClass = "bg-green-500 bg-opacity-10 border-green-500";
                icon = "‚úÖ";
                text = `<span class="text-green-400">Clean - 0 detections</span>`;
            }
            
            threatIntelHtml += `
                <div class="p-3 rounded-lg ${statusClass} border bg-opacity-20 mb-2">
                    <div class="flex items-center justify-between">
                        <span class="text-gray-300 text-sm font-semibold">ü¶† VirusTotal</span>
                        ${icon}
                    </div>
                    <div class="mt-1">${text}</div>
                    <div class="text-xs text-gray-500 mt-1">${serviceExplanations.virustotal_url}</div>
                </div>
            `;
        }

        // ZeroRisk Sentinel Deep Scan service badge
        if (r.services?.urlscan_io?.available || r.deep_scan) {
            threatIntelHtml += `
                <div class="p-3 rounded-lg bg-purple-500 bg-opacity-10 border-purple-500 border bg-opacity-20 mb-2">
                    <div class="flex items-center justify-between">
                        <span class="text-gray-300 text-sm font-semibold">üî¨ ZeroRisk Sentinel Deep Scan</span>
                        ‚úÖ
                    </div>
                    <div class="mt-1"><span class="text-purple-400">Sandbox analysis completed</span></div>
                    <div class="text-xs text-gray-500 mt-1">${serviceExplanations.urlscan_io}</div>
                </div>
            `;
        }
        
        //  DEEP SCAN / SANDBOX SECTION 
let deepScanHtml = "";
        if (r.deep_scan && r.urlscan_data) {
            const us = r.urlscan_data;
            const v = us.verdicts || {};
            
            // Verdict badges
            let verdictBadges = "";
            if (v.malicious) {
                verdictBadges += `<span class="px-2 py-1 bg-red-500 bg-opacity-30 text-red-400 text-xs rounded mr-2">üö® MALICIOUS</span>`;
            }
            if (v.suspicious) {
                verdictBadges += `<span class="px-2 py-1 bg-yellow-500 bg-opacity-30 text-yellow-400 text-xs rounded mr-2">‚ö†Ô∏è SUSPICIOUS</span>`;
            }
            if (v.phishing) {
                verdictBadges += `<span class="px-2 py-1 bg-orange-500 bg-opacity-30 text-orange-400 text-xs rounded mr-2">üé£ PHISHING</span>`;
            }
            if (!v.malicious && !v.suspicious && !v.phishing) {
                verdictBadges += `<span class="px-2 py-1 bg-green-500 bg-opacity-20 text-green-400 text-xs rounded mr-2">‚úÖ CLEAN</span>`;
            }
            
            // Network stats
            const ns = us.network_stats || {};
            const networkSection = `
                <div class="mb-4">
                    <h4 class="text-gray-400 text-sm mb-2 font-semibold uppercase tracking-wider">üåê Network Activity</h4>
                    <div class="grid grid-cols-2 md:grid-cols-4 gap-2">
                        <div class="p-3 rounded-lg bg-gray-800 border border-gray-700 text-center">
                            <div class="text-2xl font-bold text-blue-400">${ns.total_requests || 0}</div>
                            <div class="text-xs text-gray-500">Total Requests</div>
                        </div>
                        <div class="p-3 rounded-lg ${ns.suspicious_domains > 0 ? 'bg-red-900/30 border-red-500' : 'bg-gray-800 border-gray-700'} text-center">
                            <div class="text-2xl font-bold ${ns.suspicious_domains > 0 ? 'text-red-400' : 'text-green-400'}">${ns.suspicious_domains || 0}</div>
                            <div class="text-xs text-gray-500">Suspicious Domains</div>
                        </div>
                        <div class="p-3 rounded-lg bg-gray-800 border border-gray-700 text-center">
                            <div class="text-2xl font-bold text-purple-400">${ns.unique_domains || 0}</div>
                            <div class="text-xs text-gray-500">Unique Domains</div>
                        </div>
                        <div class="p-3 rounded-lg bg-gray-800 border border-gray-700 text-center">
                            <div class="text-2xl font-bold text-cyan-400">${ns.certificates || 0}</div>
                            <div class="text-xs text-gray-500">Certificates</div>
                        </div>
                    </div>
                </div>
            `;
            
            // Suspicious domains list
            let suspiciousDomainsSection = '';
            if (us.suspicious_domains && us.suspicious_domains.length > 0) {
                suspiciousDomainsSection = `
                    <div class="mb-4 p-3 rounded-lg bg-red-900/20 border border-red-500/50">
                        <h4 class="text-red-400 text-sm font-semibold mb-2">‚ö†Ô∏è Page tried to load resources from:</h4>
                        <ul class="space-y-1">
                            ${us.suspicious_domains.map(d => `<li class="text-gray-300 text-sm font-mono">‚Ä¢ ${d}</li>`).join('')}
                        </ul>
                    </div>
                `;
            }
            
            // Brand detection
            let brandSection = '';
            if (us.brands_detected && us.brands_detected.length > 0) {
                brandSection = `
                    <div class="mb-4">
                        <h4 class="text-gray-400 text-sm mb-2 font-semibold uppercase tracking-wider">üè∑Ô∏è Brands Detected</h4>
                        <div class="flex flex-wrap gap-2">
                            ${us.brands_detected.map(b => `<span class="px-3 py-1 bg-blue-900/30 border border-blue-500/50 text-blue-400 text-sm rounded-full">${b}</span>`).join('')}
                        </div>
                    </div>
                `;
            }
            
            // Server info
            const serverSection = `
                <div class="mb-4">
                    <h4 class="text-gray-400 text-sm mb-2 font-semibold uppercase tracking-wider">üñ•Ô∏è Server Info</h4>
                    <div class="grid grid-cols-2 md:grid-cols-3 gap-2 text-sm">
                        <div class="p-2 rounded bg-gray-800"><span class="text-gray-500">IP:</span> <span class="text-gray-300 font-mono">${us.ip || 'unknown'}</span></div>
                        <div class="p-2 rounded bg-gray-800"><span class="text-gray-500">Country:</span> <span class="text-gray-300">${us.country || 'unknown'}</span></div>
                        <div class="p-2 rounded bg-gray-800"><span class="text-gray-500">Server:</span> <span class="text-gray-300 font-mono">${us.server || 'unknown'}</span></div>
                    </div>
                </div>
            `;
            
            // DOM Hash
            const domSection = us.dom_hash ? `
                <div class="mb-4">
                    <h4 class="text-gray-400 text-sm mb-2 font-semibold uppercase tracking-wider">#Ô∏è‚É£ DOM Hash</h4>
                    <div class="p-2 rounded bg-gray-900 border border-gray-700">
                        <code class="text-xs text-gray-400 font-mono break-all">${us.dom_hash}</code>
                    </div>
                </div>
            ` : '';
            
            let visualSection = '';
            const hasScreenshot = us.screenshot;
            const hasConsole = us.console_logs && us.console_logs.length > 0;
            
            if (hasScreenshot || hasConsole) {
                const formattedLogs = hasConsole ? us.console_logs.map(log => {
                    let logText = '';
                    if (typeof log === 'object' && log !== null) {
                        const msg = log.message || log;
                        if (typeof msg === 'object') {
                            logText = msg.text || JSON.stringify(log);
                        } else {
                            logText = String(msg);
                        }
                    } else {
                        logText = String(log);
                    }
                    let colorClass = 'text-gray-400';
                    const level = (log.message && log.message.level) || log.level;
                    if (level === 'error') colorClass = 'text-red-400';
                    if (level === 'warning') colorClass = 'text-yellow-400';
                    
                    return `<div class="${colorClass} mb-1 whitespace-nowrap px-1 hover:bg-gray-800 rounded cursor-default" title="${logText}">${logText}</div>`;
                }).join('') : '';
                
                visualSection = `
                    <div class="mb-4">
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4 h-80">
                            ${hasScreenshot ? `
                            <div class="h-full">
                                <h4 class="text-gray-400 text-sm mb-2 font-semibold uppercase tracking-wider">Screenshot</h4>
                                <div class="relative group cursor-pointer h-[calc(100%-2rem)]" onclick="window.open('${us.screenshot}', '_blank')">
                                    <img src="${us.screenshot}" alt="Page Screenshot" class="w-full h-full object-contain bg-gray-900 rounded-lg border border-gray-700 hover:border-purple-500 transition-all">
                                    <div class="absolute inset-0 bg-black bg-opacity-50 flex items-center justify-center opacity-0 group-hover:opacity-100 transition-opacity rounded-lg">
                                        <span class="text-white font-semibold">Click to Enlarge</span>
                                    </div>
                                </div>
                            </div>
                            ` : ''}
                            ${hasConsole ? `
                            <div class="h-full flex flex-col">
                                <h4 class="text-gray-400 text-sm mb-2 font-semibold uppercase tracking-wider">Console Logs (${us.console_logs.length})</h4>
                                <div class="flex-1 overflow-auto bg-black rounded-lg p-2 text-xs font-mono border border-gray-700" style="scrollbar-width: thin; scrollbar-color: #00d4ff #1a1a1a;">
                                    <div class="min-w-max">
                                        ${formattedLogs}
                                    </div>
                                </div>
                            </div>
                            ` : ''}
                        </div>
                    </div>
                `;
            }
            
            deepScanHtml = `
                <div class="mb-6 p-4 rounded-lg bg-purple-900/20 border border-purple-500/50">
                    <div class="flex items-center justify-between mb-3">
                        <h4 class="text-purple-400 font-semibold flex items-center text-lg">
                            <span class="mr-2">üî¨</span> ZeroRisk Sentinel Sandbox Analysis
                        </h4>
                        <div>${verdictBadges}</div>
                    </div>
                    
                    <!-- Network Stats -->
                    ${networkSection}
                    
                    <!-- Screenshot & Console Side-by-Side -->
                    ${visualSection}
                    
                    <!-- Server Info -->
                    ${serverSection}
                    
                    <!-- Suspicious Domains -->
                    ${suspiciousDomainsSection}
                    
                    <!-- Brands -->
                    ${brandSection}
                    
                    <!-- DOM Hash -->
                    ${domSection}
                </div>
            `;
        }
        
        //  TECHNICAL DETAILS SECTION (Shows for BOTH normal AND deep scan) 
        let techDetailsHtml = "";
        
        if (r.services?.ssl?.available) {
            const ssl = r.services.ssl;
            let sslIcon, sslText, sslClass;
            
            if (!ssl.has_ssl) {
                sslIcon = "‚ùå";
                sslText = '<span class="text-red-400">No HTTPS</span>';
                sslClass = "bg-red-500 bg-opacity-10 border-red-500";
            } else if (ssl.suspicious) {
                sslIcon = "‚ö†Ô∏è";
                sslText = `<span class="text-yellow-400">Issues: ${ssl.self_signed ? 'Self-signed' : 'Expiring soon'}</span>`;
                sslClass = "bg-yellow-500 bg-opacity-10 border-yellow-500";
            } else {
                sslIcon = "üîí";
                sslText = `<span class="text-green-400">Valid (${ssl.days_left} days)</span>`;
                sslClass = "bg-green-500 bg-opacity-10 border-green-500";
            }
            
            techDetailsHtml += `
                <div class="p-2 rounded ${sslClass} border text-xs">
                    <div class="text-gray-400 mb-1">SSL Certificate</div>
                    <div class="font-semibold">${sslIcon} ${sslText}</div>
                </div>
            `;
        }
        
        if (r.services?.domain_age?.available) {
            const age = r.services.domain_age;
            const ageClass = age.suspicious ? "bg-red-500 bg-opacity-10 border-red-500 text-red-400" : "bg-gray-700 border-gray-600 text-gray-300";
            
            techDetailsHtml += `
                <div class="p-2 rounded ${ageClass} border text-xs">
                    <div class="text-gray-400 mb-1">Domain Age</div>
                    <div class="font-semibold">${age.suspicious ? '‚ö†Ô∏è ' : ''}${Math.round(age.days / 365.25 * 10) / 10} years</div>
                </div>
            `;
        }
        
        if (r.services?.redirects?.available) {
            const red = r.services.redirects;
            const redClass = red.suspicious ? "bg-yellow-500 bg-opacity-10 border-yellow-500" : "bg-gray-700 border-gray-600";
            
            techDetailsHtml += `
                <div class="p-2 rounded ${redClass} border text-xs">
                    <div class="text-gray-400 mb-1">Redirects</div>
                    <div class="font-semibold ${red.suspicious ? 'text-yellow-400' : 'text-gray-300'}">${red.count} hop${red.count !== 1 ? 's' : ''}</div>
                </div>
            `;
        }
        
        if (r.services?.dns?.available) {
            const dns = r.services.dns;
            techDetailsHtml += `
                <div class="p-2 rounded bg-gray-700 border-gray-600 border text-xs">
                    <div class="text-gray-400 mb-1">DNS Records</div>
                    <div class="font-semibold text-gray-300">
                        A:${dns.has_a ? '‚úì' : '‚úó'} MX:${dns.has_mx ? '‚úì' : '‚úó'} SPF:${dns.has_spf ? '‚úì' : '‚úó'}
                    </div>
                </div>
            `;
        }
        
        //  DETECTED INDICATORS 
        let findingsHtml = "";
        if (r.findings && r.findings.length > 0) {
            findingsHtml = r.findings.map(f => {
                const explanation = findingExplanations[f.type] || "This pattern matches known suspicious behavior.";
                const severityColor = f.severity === 'high' || f.severity === 'critical' ? 'text-red-400 border-red-500' : 
                                    f.severity === 'medium' ? 'text-yellow-400 border-yellow-500' : 
                                    'text-gray-400 border-gray-600';
                
                return `
                    <div class="p-3 rounded-lg border ${severityColor} bg-opacity-10 bg-black mb-2">
                        <div class="flex items-start">
                            <span class="mr-2">${f.severity === 'high' || f.severity === 'critical' ? 'üö®' : f.severity === 'medium' ? '‚ö†Ô∏è' : '‚ÑπÔ∏è'}</span>
                            <div>
                                <div class="font-semibold ${severityColor.split(' ')[0]}">${f.description}</div>
                                <div class="text-xs text-gray-500 mt-1">${explanation}</div>
                            </div>
                        </div>
                    </div>
                `;
            }).join("");
        } else {
            findingsHtml = `<div class="p-3 rounded-lg border border-green-500 bg-green-500 bg-opacity-10 text-green-400">‚úÖ No suspicious indicators detected</div>`;
        }
        
        //  ANALYSIS SUMMARY 
        const explanationSection = `
            <div class="mt-4 p-4 rounded-lg bg-black/80 border border-blue-500/40">
                <h4 class="text-blue-400 font-semibold mb-2 flex items-center">
                    <svg class="w-4 h-4 mr-2" fill="currentColor" viewBox="0 0 20 20">
                        <path d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-11a1 1 0 10-2 0v2H7a1 1 0 100 2h2v2a1 1 0 102 0v-2h2a1 1 0 100-2h-2V7z"/>
                    </svg>
                    Analysis Summary
                </h4>
                <pre class="text-gray-300 text-sm whitespace-pre-wrap font-mono leading-relaxed">${r.explanation || 'No explanation available.'}</pre>
                <p class="text-xs text-gray-500 mt-2">
                    ${r.deep_scan ? 'üî¨ Deep Scan: Backend threat intelligence + ZeroRisk Sentinel Sandbox Analysis' : (r.backend_based ? 'üîç Backend Analysis: Google Safe Browsing, URLHaus, VirusTotal, SSL, DNS' : 'üíª Local Analysis: Heuristic pattern matching')} ‚Ä¢ Not definitive proof of malicious intent
                </p>
            </div>
        `;
        
        //  BUILD FINAL CARD 
        card.innerHTML = `
            <!-- Header -->
            <div class="flex flex-col md:flex-row md:justify-between md:items-start mb-4 gap-2">
                <div class="flex-1 min-w-0">
                    <h3 class="text-lg font-semibold text-white truncate">üîó ${r.url}</h3>
                    <p class="text-gray-400 text-sm">${r.domain || ''}</p>
                </div>
                <div class="flex items-center flex-shrink-0">
                    <span class="threat-badge threat-${r.threat_level}">${r.threat_level.toUpperCase()}</span>
                    ${analysisBadge}
                </div>
            </div>
            
            <!-- Score & Time -->
            <div class="flex items-center justify-between mb-4 p-3 rounded-lg bg-black/50">
                <div>
                    <span class="text-gray-400 text-sm">Threat Score</span>
                    <div class="text-2xl font-bold text-${color}-400">${r.threat_score}<span class="text-lg text-gray-500">/100</span></div>
                </div>
                <div class="text-right">
                    <span class="text-gray-400 text-sm">Analyzed</span>
                    <div class="text-gray-300 text-sm">${new Date(r.scan_time).toLocaleString()}</div>
                </div>
            </div>
            
            <!-- DEEP SCAN SECTION (Only if deep_scan is true) -->
            ${deepScanHtml}
            
            <!-- THREAT INTELLIGENCE (Shows for BOTH regular AND deep scan) -->
            <div class="mb-4">
                <h4 class="text-gray-400 text-sm mb-2 font-semibold uppercase tracking-wider">üõ°Ô∏è Threat Intelligence</h4>
                ${threatIntelHtml || `
                    <div class="p-3 rounded-lg bg-gray-800 border border-gray-700 text-gray-400 text-sm">
                        No additional threat intelligence data available
                    </div>
                `}
            </div>
            
            <!-- TECHNICAL DETAILS -->
            ${techDetailsHtml ? `
                <div class="mb-4">
                    <h4 class="text-gray-400 text-sm mb-2 font-semibold uppercase tracking-wider">Technical Details</h4>
                    <div class="grid grid-cols-2 md:grid-cols-4 gap-2">
                        ${techDetailsHtml}
                    </div>
                </div>
            ` : ''}
            
            <!-- DETECTED INDICATORS -->
            <div class="mb-2">
                <h4 class="text-gray-400 text-sm mb-2 font-semibold uppercase tracking-wider">Detected Indicators (${r.findings?.length || 0})</h4>
                ${findingsHtml}
            </div>
            
            <!-- EXPLANATION -->
            ${explanationSection}
        `;
        
        container.appendChild(card);
        
        // Animate in
        setTimeout(() => {
            anime({
                targets: card,
                opacity: [0, 1],
                translateY: [30, 0],
                duration: 600,
                easing: "easeOutQuart"
            });
        }, i * 100);
    });
}
      // Initialize everything when DOM is loaded
      document.addEventListener("DOMContentLoaded", () => {
        
        startMatrixBackground();
        initializeCharts();
        const fileData = JSON.parse(
          sessionStorage.getItem("analysisResults") || "[]"
        );
        const urlOnlyData = JSON.parse(
          sessionStorage.getItem("urlResults") || "[]"
        );
        if (urlOnlyData.length > 0) {
            renderURLResults(urlOnlyData);
        }
        const fileSection = document.getElementById("fileSection");
        const fileOverview = document.getElementById("fileOverview");
        const urlSection = document.getElementById("urlSection");

        // If ONLY URL was scanned
        if (fileData.length === 0 && urlOnlyData.length > 0) {
          if (fileSection) fileSection.style.display = "none";
          if (fileOverview) fileOverview.style.display = "none";

          // Prevent fake file stats
          document.getElementById("filesAnalyzed").textContent = "‚Äî";
          document.getElementById("safeFiles").textContent = "‚Äî";
          document.getElementById("warningFiles").textContent = "‚Äî";
          document.getElementById("criticalFiles").textContent = "‚Äî";
        }

        // If ONLY files were scanned
        if (fileData.length > 0 && urlOnlyData.length === 0) {
          if (urlSection) urlSection.style.display = "none";
        }

        // If nothing was scanned (edge case)
        if (fileData.length === 0 && urlOnlyData.length === 0) {
          if (fileSection) fileSection.style.display = "none";
          if (fileOverview) fileOverview.style.display = "none";
          if (urlSection) urlSection.style.display = "none";
        }

        // LOAD ANALYSIS RESULTS FROM SCANNER
        const storedResults = sessionStorage.getItem("analysisResults");

        if (storedResults) {
          const results = JSON.parse(storedResults);

          let safe = 0;
          let warning = 0;
          let critical = 0;

          results.forEach((r) => {
            if (r.threatLevel === "safe") safe++;
            else if (r.threatLevel === "low" || r.threatLevel === "medium")
              warning++;
            else if (r.threatLevel === "high" || r.threatLevel === "critical")
              critical++;
          });

          document.getElementById("filesAnalyzed").textContent = results.length;
          document.getElementById("safeFiles").textContent = safe;
          document.getElementById("warningFiles").textContent = warning;
          document.getElementById("criticalFiles").textContent = critical;
          renderDynamicResults(results);

          // SPYWARE BEHAVIOR PROFILE (FIRST HIGH-RISK FILE)
          const criticalFile = results.find(
            (r) => r.threatLevel === "high" || r.threatLevel === "critical"
          );
        }

        // Animate cards on scroll
        const observerOptions = {
          threshold: 0.1,
          rootMargin: "0px 0px -50px 0px",
        };

        const observer = new IntersectionObserver((entries) => {
          entries.forEach((entry) => {
            if (entry.isIntersecting) {
              anime({
                targets: entry.target,
                opacity: [0, 1],
                translateY: [50, 0],
                duration: 800,
                easing: "easeOutQuart",
              });
            }
          });
        }, observerOptions);
        // Animate security gauge when it comes into view
        const gaugeTarget = document.getElementById("securityScoreChart");

        const gaugeObserver = new IntersectionObserver(
          (entries) => {
            entries.forEach((entry) => {
              if (entry.isIntersecting && securityGaugeChart) {
                securityGaugeChart.setOption({
                  series: [
                    {
                      data: [{ value: lastSecurityScore }],
                    },
                  ],
                });
              }
            });
          },
          { threshold: 0.5 }
        );

        if (gaugeTarget) {
          gaugeObserver.observe(gaugeTarget);
        }

        document.querySelectorAll(".analysis-card").forEach((card) => {
          card.style.opacity = "0";
          observer.observe(card);
        });
      });
    </script>
    <script src="main.js"></script>
    <script src="generateReport.js"></script>
    
    <div
      id="swipeHint"
      class="fixed bottom-4 left-1/2 -translate-x-1/2 text-xs text-gray-400 opacity-70 md:hidden select-none pointer-events-none"
    >
      ‚Üê Swipe to change pages ‚Üí
    </div>
  </body>
</html>